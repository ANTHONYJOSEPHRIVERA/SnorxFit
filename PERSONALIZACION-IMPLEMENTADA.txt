â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         âœ¨ SISTEMA DE PERSONALIZACIÃ“N IMPLEMENTADO âœ¨            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ OBJETIVO CUMPLIDO:
"nuestra app debe de estudiar la conducta de usuario, gusto, que suele 
comer... todo debe ir aprendiendo basado a cada usuario"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‚ ARCHIVOS MODIFICADOS/CREADOS:

1. âœ… src/utils/userAnalytics.js (NUEVO - 300+ lÃ­neas)
   - Sistema completo de anÃ¡lisis de preferencias
   - Detecta patrones de alimentaciÃ³n
   - Calcula promedios y macros preferidos
   - Clasifica tipo de dieta del usuario

2. âœ… src/components/Chatbot.js (MODIFICADO)
   - Integrado sistema de personalizaciÃ³n
   - Carga preferencias del usuario automÃ¡ticamente
   - Genera contexto personalizado para Gemini
   - Muestra favoritos en sidebar

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”§ FUNCIONALIDADES IMPLEMENTADAS:

1ï¸âƒ£ ANÃLISIS DE PREFERENCIAS (userAnalytics.js):
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   
   ğŸ“Š analyzeUserPreferences(userId, days=30)
   â€¢ Escanea Ãºltimos 30 dÃ­as de foodLogs
   â€¢ Cuenta frecuencia de cada alimento
   â€¢ Identifica top 15 alimentos favoritos
   â€¢ Detecta patrones por tipo de comida:
     - Desayunos favoritos
     - Almuerzos favoritos  
     - Cenas favoritas
     - Snacks favoritos
   â€¢ Calcula promedios diarios:
     - CalorÃ­as promedio
     - ProteÃ­nas promedio
     - Carbohidratos promedio
     - Grasas promedio
   â€¢ Determina preferencias de macros:
     - % ProteÃ­na
     - % Carbohidratos
     - % Grasas
   â€¢ Clasifica tipo de dieta:
     - "Alta en ProteÃ­na" (>30%)
     - "Alta en Carbohidratos" (>50%)
     - "Balanceada"
     - "Baja en CalorÃ­as"
     - "Alta en CalorÃ­as"
   
   ğŸ’¾ Guarda resultados en:
   users/{uid}/analytics/preferences
   
   Ejemplo de resultado:
   {
     favoriteFoods: [
       { name: "Pollo", count: 15, percentage: 45 },
       { name: "Arroz integral", count: 12, percentage: 38 },
       { name: "Huevos", count: 10, percentage: 33 }
     ],
     mealPatterns: {
       breakfast: ["Avena", "Huevos", "Pan integral"],
       lunch: ["Pollo", "Arroz", "Ensalada"],
       dinner: ["Pescado", "Verduras", "Quinoa"]
     },
     averages: {
       calories: 2450,
       protein: 135,
       carbs: 270,
       fat: 68
     },
     macroPreferences: {
       proteinPercent: 22,
       carbsPercent: 44,
       fatPercent: 25
     },
     dietType: "Alta en ProteÃ­na"
   }

   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   ğŸ¯ generatePersonalizedContext(userProfile, preferences, foodData)
   â€¢ Genera contexto RICO para Gemini AI
   â€¢ Incluye informaciÃ³n personalizada:
     - Alimentos mÃ¡s consumidos (top 5)
     - Desayunos habituales
     - Almuerzos habituales
     - Cenas habituales
     - Promedio diario de macros
     - Tipo de dieta detectado
     - Objetivo del usuario
     - Consumo de hoy vs. promedio
   
   Ejemplo de contexto generado:
   "
   === INFORMACIÃ“N PERSONALIZADA DEL USUARIO ===
   
   ALIMENTOS MÃS CONSUMIDOS:
   â€¢ Pollo (45% de los dÃ­as)
   â€¢ Arroz integral (38% de los dÃ­as)
   â€¢ Huevos (33% de los dÃ­as)
   â€¢ BrÃ³coli (30% de los dÃ­as)
   
   DESAYUNOS HABITUALES: Avena, Huevos revueltos, Pan integral
   ALMUERZOS HABITUALES: Pollo a la plancha, Arroz integral, Ensalada
   CENAS HABITUALES: Pescado, Verduras al vapor, Quinoa
   
   PROMEDIOS DIARIOS:
   â€¢ CalorÃ­as: 2450 kcal
   â€¢ ProteÃ­na: 135g (22%)
   â€¢ Carbohidratos: 270g (44%)
   â€¢ Grasas: 68g (25%)
   
   TIPO DE DIETA: Alta en ProteÃ­na
   OBJETIVO: Perder peso (2000 kcal/dÃ­a)
   
   HOY HA CONSUMIDO: 1850 kcal (150 kcal por debajo del promedio)
   "

   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   ğŸ’¡ getPersonalizedSuggestions(preferences, mealType, currentTime)
   â€¢ Genera sugerencias basadas en historial
   â€¢ EspecÃ­ficas para cada tipo de comida
   â€¢ Alerta sobre deficiencias de macros
   
   Ejemplo:
   Si es hora del almuerzo:
   "Basado en tu historial, sueles comer: Pollo, Arroz integral, 
   Ensalada. Estos alimentos han funcionado bien para tu objetivo."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

2ï¸âƒ£ INTEGRACIÃ“N EN CHATBOT (Chatbot.js):
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   
   ğŸ“¥ Nuevos imports:
   import { 
     getUserPreferences, 
     generatePersonalizedContext, 
     analyzeUserPreferences 
   } from '../utils/userAnalytics';
   
   ğŸ“¦ Nuevos estados:
   const [userPreferences, setUserPreferences] = useState(null);
   const [userProfile, setUserProfile] = useState(null);
   
   ğŸ”„ useEffect para cargar datos:
   â€¢ Carga perfil del usuario desde Firestore
   â€¢ Carga preferencias existentes o genera nuevas
   â€¢ Auto-analiza si no hay preferencias (despuÃ©s de 3s)
   
   ğŸ¤– handleSendMessage MEJORADO:
   Cuando Gemini es llamado:
   1. Crea contexto bÃ¡sico (comida de hoy, objetivo)
   2. ğŸ†• Agrega contexto PERSONALIZADO:
      - Genera con generatePersonalizedContext()
      - Incluye historial de 30 dÃ­as
      - Menciona alimentos favoritos
      - Informa promedios y patrones
   3. Gemini recibe TODA la informaciÃ³n personalizada
   4. Respuestas son ESPECÃFICAS para cada usuario
   
   ğŸ¨ SIDEBAR MEJORADO:
   â€¢ Muestra "ğŸ¯ Tus Favoritos"
   â€¢ Lista top 3 alimentos con porcentaje
   â€¢ Muestra tipo de dieta detectado
   â€¢ ActualizaciÃ³n automÃ¡tica

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¬ FLUJO COMPLETO DE PERSONALIZACIÃ“N:

1. Usuario registra alimentos en FoodLog
   â†“
2. Datos se guardan en Firebase (foodLogs)
   â†“
3. Al abrir Chatbot, se carga perfil del usuario
   â†“
4. Se ejecuta getUserPreferences(userId)
   â†“
5. Si no hay preferencias guardadas:
   â†’ analyzeUserPreferences(userId, 30)
   â†’ Escanea Ãºltimos 30 dÃ­as
   â†’ Detecta patrones y favoritos
   â†’ Guarda en Firebase
   â†“
6. Usuario hace pregunta al chatbot
   â†“
7. Si necesita Gemini API:
   â†’ generatePersonalizedContext()
   â†’ Crea contexto RICO con historial
   â†’ Gemini recibe contexto personalizado
   â†’ Respuesta ESPECÃFICA para ese usuario
   â†“
8. Sidebar muestra favoritos y tipo de dieta

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š ESTRUCTURA EN FIREBASE:

users/
  {uid}/
    profile (existente)
      - weight, height, age, goal, calorieGoal
    
    foodLogs/ (existente)
      {YYYY-MM-DD}/
        - meals: {breakfast, lunch, dinner, snacks}
        - water, updatedAt
    
    analytics/ (NUEVO)
      preferences/
        - favoriteFoods: [{name, count, percentage}]
        - mealPatterns: {breakfast[], lunch[], dinner[], snacks[]}
        - averages: {calories, protein, carbs, fat}
        - macroPreferences: {proteinPercent, carbsPercent, fatPercent}
        - dietType: string
        - lastAnalyzed: timestamp
        - daysAnalyzed: number

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ¨ EJEMPLOS DE RESPUESTAS PERSONALIZADAS:

âŒ ANTES (sin personalizaciÃ³n):
Usuario: "Â¿QuÃ© debo comer hoy?"
Bot: "Para una dieta saludable, te recomiendo proteÃ­nas magras,
      carbohidratos complejos y verduras."

âœ… AHORA (con personalizaciÃ³n):
Usuario: "Â¿QuÃ© debo comer hoy?"
Bot: "Basado en tu historial, veo que normalmente consumes pollo
      (45% de los dÃ­as), arroz integral (38%) y brÃ³coli (30%).
      
      Hoy has consumido 1850 kcal, 150 kcal menos que tu promedio
      de 2450 kcal. Sigues una dieta alta en proteÃ­na.
      
      Para el almuerzo te sugiero seguir con tus alimentos favoritos:
      - 200g Pollo a la plancha (330 kcal, 62g proteÃ­na)
      - 150g Arroz integral (195 kcal, 40g carbos)
      - BrÃ³coli al vapor (55 kcal, 5g proteÃ­na)
      
      Esto te llevarÃ¡ a 2430 kcal, justo en tu promedio habitual."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ§ª CÃ“MO PROBAR:

1. âœ… Cargar datos de ejemplo (firebase-seed-anthony.js):
   - Abrir Firefox Console (F12)
   - Ir a Firebase Console
   - Pegar script firebase-seed-anthony.js
   - Ejecutar uploadFoodLogsToAnthony()
   - Esto cargarÃ¡ 7 dÃ­as de datos

2. âœ… Abrir Chatbot:
   - El sistema detectarÃ¡ que no hay preferencias
   - AutomÃ¡ticamente analizarÃ¡ los 7 dÃ­as
   - MostrarÃ¡ favoritos en sidebar

3. âœ… Hacer preguntas:
   - "Â¿QuÃ© debo comer hoy?"
   - "Â¿EstÃ¡ bien mi dieta?"
   - "Dame opciones para el almuerzo"
   - "Â¿CÃ³mo voy con mis macros?"

4. âœ… Verificar en consola:
   - "ğŸ¯ Preferencias del usuario cargadas: ..."
   - "âœ¨ Contexto personalizado agregado: ..."
   - "ğŸ‘¤ Perfil de usuario cargado: ..."

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”„ FUNCIÃ“N MANUAL DE REFRESH:

Si necesitas actualizar preferencias manualmente:

// En la consola del navegador:
refreshUserPreferences()

Esto re-escanearÃ¡ los Ãºltimos 30 dÃ­as y actualizarÃ¡ las preferencias.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ˆ VENTAJAS DEL SISTEMA:

âœ… VERDADERA PERSONALIZACIÃ“N:
   - No solo guarda datos, los ANALIZA
   - Detecta patrones reales del usuario
   - Respuestas especÃ­ficas, no genÃ©ricas

âœ… APRENDIZAJE AUTOMÃTICO:
   - Cada alimento registrado mejora el modelo
   - ActualizaciÃ³n continua de preferencias
   - AdaptaciÃ³n a cambios de hÃ¡bitos

âœ… CONTEXTO RICO PARA IA:
   - Gemini recibe historial completo
   - Conoce alimentos favoritos
   - Entiende objetivos y patrones
   - Genera consejos personalizados

âœ… EXPERIENCIA DE USUARIO:
   - Sidebar muestra favoritos al instante
   - No hay esperas para anÃ¡lisis
   - Cache de preferencias en Firebase
   - UI limpia y clara

âœ… ESCALABLE:
   - Funciona con 7 dÃ­as o 365 dÃ­as
   - Configurable (days=30 por defecto)
   - No afecta rendimiento
   - AnÃ¡lisis solo cuando es necesario

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¯ CONCLUSIÃ“N:

El sistema AHORA SÃ cumple el objetivo de personalizaciÃ³n.
No solo almacena datos, sino que los ESTUDIA y APRENDE.

Cada usuario tendrÃ¡:
â€¢ Su propio perfil de preferencias
â€¢ Sus alimentos favoritos detectados
â€¢ Su tipo de dieta clasificado
â€¢ Respuestas especÃ­ficas para sus hÃ¡bitos
â€¢ Sugerencias basadas en historial real

Â¡LA APP APRENDE DE CADA USUARIO! ğŸ‰

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Creado: 2025
Sistema: SnorxFit - Asistente IA Personalizado
